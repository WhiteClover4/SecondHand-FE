name: Deploy

# we use gitlab ci to deploy

on:
  push:
    branches:
    - '!staging'
    - '!main'
  pull_request:
    branches:
    - '!staging'
    - '!main'

jobs:
  development:
    name: Staging Deployment
    environment:
      name: Development
      url: https://secondhand-binar-staging.herokuapp.com
    runs-on: ubuntu-latest
    if: github.event.ref == 'refs/heads/staging'

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Deploy the Staging App to Heroku
      uses: akhileshns/heroku-deploy@v3.12.12
      with:
        heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
        heroku_app_name: 'secondhand-binar-staging'
        heroku_email: 'alfirman.pahlepi@gmail.com'
        branch: 'staging'

  # production:
  #   name: Production Deployment
  #   environment:
  #     name: Production
  #     url: https://secondhand-binar.vercel.app/
  #   runs-on: ubuntu-latest
  #   if: github.event.ref == 'refs/heads/main'

  #   strategy:
  #     matrix:
  #       node-version: [16.x]

  #   steps:
  #   - name: Checkout
  #     uses: actions/checkout@v3
  #     with:
  #       node-version: ${{ matrix.node-version }}
  #       cache: 'yarn'

  #   - name: Install dependencies
  #     run: yarn

  #   - name: Build
  #     run: yarn build

  #   - name: Install Vercel CLI
  #     run: yarn global add vercel

  #   - name: Deploy to Production
  #       uses: amondnet/vercel-action@v20
  #       id: deploy-vercel-production
  #       if: github.event_name == 'push' && github.ref == 'refs/heads/main'
  #       with:
  #         vercel-token: ${{ secrets.VERCEL_TOKEN }}
  #         vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
  #         vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
  #         vercel-args: '--prod'
  #         scope: ${{ secrets.VERCEL_ORG_ID }}
